<!DOCTYPE html>
<html>
<head>
    <title>Chatbot</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=420">
    <style>
        body { font-family: Arial, sans-serif; background: #f6f6f6; }
        #container { width: 420px; margin: 40px auto; background: #fff; box-shadow: 0 0 8px #ccc; border-radius: 8px; padding: 20px; }
        h2 { text-align: center; }
        #chatbox { width: 100%; height: 350px; border: 1px solid #ccc; overflow-y: auto; margin-bottom: 10px; background: #fafafa; padding: 8px; border-radius: 5px; }
        .bubble { margin: 6px 0; padding: 8px 12px; border-radius: 15px; max-width: 75%; display: inline-block; }
        .user { background: #d0e6ff; align-self: flex-end; float: right; clear: both; }
        .bot { background: #ebebeb; align-self: flex-start; float: left; clear: both; }
        #userInput { width: 70%; padding: 7px; border-radius: 4px; border: 1px solid #ccc; }
        #send { padding: 7px 16px; border-radius: 4px; border: none; background: #3881ff; color: white; font-weight: bold; cursor: pointer; }
        #send:disabled { background: #aaa; cursor: not-allowed; }
        @media (max-width: 500px) {
            #container { width: 98vw; padding: 2vw; }
        }
    </style>
</head>
<body>
    <div id="container">
        <h2>Chat with Krutihii ðŸ¤–</h2>
        <div id="chatbox"></div>
        <form id="inputForm" style="display:flex;gap:8px;" autocomplete="off" onsubmit="return false;">
            <input type="text" id="userInput" autocomplete="off" placeholder="Type a message..." autofocus />
            <button id="send" type="submit">Send</button>
        </form>
    </div>
    <script>
        const chatbox = document.getElementById("chatbox");
        const userInput = document.getElementById("userInput");
        const sendBtn = document.getElementById("send");
        const inputForm = document.getElementById("inputForm");

        function appendMessage(sender, message) {
            const bubble = document.createElement("div");
            bubble.className = "bubble " + (sender === "You" ? "user" : "bot");
            bubble.innerHTML = "<b>" + sender + ":</b> " + message;
            chatbox.appendChild(bubble);
            chatbox.scrollTop = chatbox.scrollHeight;
        }

        function setLoading(state) {
            sendBtn.disabled = state;
            sendBtn.innerText = state ? "..." : "Send";
        }

        async function handleSend() {
            const msg = userInput.value.trim();
            if (!msg) return;
            appendMessage("You", msg);
            userInput.value = "";
            setLoading(true);
            try {
                const res = await fetch("/get", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ msg: msg })
                });
                if (!res.ok) throw new Error("Network Error");
                const data = await res.json();
                if (data.reply) appendMessage("Krutihii", data.reply);
                else appendMessage("Krutihii", "Sorry, I didn't understand that.");
            } catch (e) {
                appendMessage("Krutihii", "Error: Unable to connect at the moment.");
            }
            setLoading(false);
        }

        inputForm.addEventListener("submit", handleSend);
        sendBtn.addEventListener("click", handleSend);
        userInput.addEventListener("keyup", (e) => {
            if (e.key === "Enter") handleSend();
        });
    </script>
</body>
</html>
